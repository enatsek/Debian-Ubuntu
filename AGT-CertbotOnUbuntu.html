<!DOCTYPE html> <html> <head> <meta charset="UTF-8"></head><body><H1>CertbotOnUbuntu: Auto Free SSL Certificates for Apache2 Tutorial on Ubuntu 22.04
</H1><p> <H4><a href="javascript:myFunction('Div1')">Copyright (C) 2020 - 2023 Exforge exforge@x386.org
</a> </H4><div id="Div1" style="margin-left:1%;"><pre ># - This document is free text: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.
#
# - This document is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# - You should have received a copy of the GNU General Public License
# along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div2')">Specs
</a> </H4><div id="Div2" style="margin-left:1%;"><pre ># Automation of SSL and certificate renewal for Apache 2 on Ubuntu
# Totally based on the document at:
<a href="https://certbot.eff.org/lets-encrypt/ubuntufocal-apache" target="_blank">https://certbot.eff.org/lets-encrypt/ubuntufocal-apache</a>
# Based on Alexey Abel's ISP Mail Tutorial Caramel Edition
<a href="https://123qwe.com/" target="_blank">https://123qwe.com/</a>
# - Apache Site configurations without SSL must be ready on your servers
# Refer to ApacheOnUbuntu Tutorial
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div3')">1. Preliminary Tasks
</a> </H4><div id="Div3" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 1.1. Snap Daemon
</B></span># - Certbot is installed as a snap, Ubuntu 22.04 installs snap daemon (snapd) 
# by default. If in any case it is not installed, you can install snapd by the
# following command:
<code><span style="Color:DodgerBlue">sudo apt install snapd
</span></code><B><span style="Font-Family:Verdana">#-- 1.2. Remove Old Certbot Packages (If any)
</B></span># If you've installed certbot's apt package before, remove it:
<code><span style="Color:DodgerBlue">sudo apt remove certbot
</span></code></pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div4')">2. Installation and Getting SSL Certificate
</a> </H4><div id="Div4" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 2.1. Ensure that your snapd (snap deamon) is up to date:
</B></span><code><span style="Color:DodgerBlue">sudo snap install core; sudo snap refresh core
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.2. Install Certbot
</B></span><code><span style="Color:DodgerBlue">sudo snap install --classic certbot
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.3. Get SSL Certificate
</B></span><code><span style="Color:DodgerBlue">sudo certbot --apache
</span></code># - Asks your email, don't hesitate giving it, you will be informed if any problems
# occurs at the renewal of certificates.
#
<B><span style="Font-Family:Verdana">#-- 2.4. Test automatic renewal
</B></span><code><span style="Color:DodgerBlue">sudo certbot renew --dry-run
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.5. All set, certificates generated and installed, all apache configurations
</B></span># are made, jobs added to crontab to renew certs.
# Check crontab:
<code><span style="Color:DodgerBlue">systemctl list-timers
</span></code></pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div5')">3. Certbot Renewal Hooks
</a> </H4><div id="Div5" style="margin-left:1%;"><pre ># - When your free certificate is automatically renewed, apache needs to be 
# restarted. Any other software using your certificate needs to be reloaded also
# (like postfix and dovecot). 
# - Certbot runs all scripts in the  /etc/letsencrypt/renewal-hooks/deploy
# directory after a successfull renewal. We'll put a script there.
<code><span style="Color:DodgerBlue">sudo nano /etc/letsencrypt/renewal-hooks/deploy/reloadall.sh
</span></code><code><span style="Color:MediumSeaGreen">#!/bin/bash
systemctl reload apache2
systemctl reload postfix
systemctl reload dovecot
</span></code># Make the script executable
<code><span style="Color:DodgerBlue">sudo chmod +x /etc/letsencrypt/renewal-hooks/deploy/reloadall.sh
</span></code></pre> </div> </p>
</pre> </div> </p>
<br /><br /><br /><script>
function myFunction(divid) {
  var x = document.getElementById(divid);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
var i;
var str;

for (i=1; i<6; i++) {
    str = "Div" + i.toString();
    myFunction(str);
}
</script></body> </html>