<!DOCTYPE html> <html> <head> <meta charset="UTF-8"></head><body><H1>LVMOnDebianUbuntu: Logical Volume Manager on Debian and Ubuntu Server
</H1><p> <H4><a href="javascript:myFunction('Div1')">Copyright (C) 2024 Exforge exforge@x386.org
</a> </H4><div id="Div1" style="margin-left:1%;"><pre ># - This document is free text: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.
#
# - This document is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# - You should have received a copy of the GNU General Public License
# along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div2')"> 0. Specs
</a> </H4><div id="Div2" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 0.1. Info
</B></span># LVM, or Logical Volume Manager allows for more flexible and dynamic
# management of disk space compared to traditional partitioning schemes. 
# Enables features such as resizing volumes, creating snapshots, and managing
# multiple physical storage devices more effectively.
#
# - To get the best of LVM, it must be defined when the OS is installed. That 
# way we can use LVM for (nearly) all of our disk space (boot partition can
# not be in LVM).
# - It is possible to install the OS without LVM and add it later too. But 
# to use LVM on the /root partition, we need to install it when we install
# the OS.
#
<B><span style="Font-Family:Verdana">#-- 0.2. Test Environment
</B></span># Tested on the following environments:
# - Debian 11
# - Debian 12
# - Ubuntu 20.04 LTS Server
# - Ubuntu 22.04 LTS Server
#
<B><span style="Font-Family:Verdana">#-- 0.3. Sources
</B></span><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_logical_volumes/index" target="_blank">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_logical_volumes/index</a>
# ChatGPT
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div3')"> 1. Layers of LVM
</a> </H4><div id="Div3" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 1.0. Abstract
</B></span># - We define Physical Volumes (PV) from disks or partitions. Define Volume
# Groups (VG) by combining PVs. Logical Volumes are defined within VGs.
#
<B><span style="Font-Family:Verdana">#-- 1.1. Physical Volumes (PV):
</B></span># - Storage devices or partitions that LVM uses as a building block.
# - Could be a complete hard drive, a disk partition, or even a RAID array.
#
<B><span style="Font-Family:Verdana">#-- 1.2. Volume Groups (VG):
</B></span># - Collections of one or more physical volumes.
# - Act as a pool that aggregates the storage space from multiple physical
# volumes.
# - Logical volumes are created within volume groups.
#
<B><span style="Font-Family:Verdana">#-- 1.3. Logical Volumes (LV):
</B></span># - An abstraction that represents a portion of a volume group.
# - Similar to partitions in traditional disk management.
# - Can be resized and moved without affecting the data stored on them.
#
# - There are 6 main LV types.
#
#- 1.3.1. Linear Logical Volume
# - Default logical volume type.
# - Data is stored sequentially.
<code><span style="Color:DodgerBlue">lvcreate -n mylv -L 10G myvg
</span></code>#
#- 1.3.2. Mirrored Logical Volume
# - Provides data redundancy with multiple copies (mirrors) of the data.
# - Offers fault tolerance; if one mirror fails, the remaining mirrors can be 
# used.
<code><span style="Color:DodgerBlue">lvcreate --type mirror --mirrors 2 -n mymirroredlv -L 10G myvg
</span></code>#
#- 1.3.3. Snapshot Logical Volume
# - Creates a point-in-time copy (snapshot) of an existing logical volume.
# - Useful for backup purposes or creating consistent images of a volume for
# testing.
<code><span style="Color:DodgerBlue">lvcreate --type snapshot -n mysnapshotlv -L 5G --snapshot /dev/myvg/mylv
</span></code>#
#- 1.3.4. Thin Logical Volume
# - Enables efficient storage allocation by using thin provisioning.
# - Allocates space only as needed, allowing for more flexible use of storage
# resources.
<code><span style="Color:DodgerBlue">lvcreate --type thin-pool -n mythinpool -L 100G myvg
</span></code><code><span style="Color:DodgerBlue">lvcreate --type thin -n mythinvolume -V 50G --thinpool myvg/mythinpool
</span></code>#
#- 1.3.5. Cache Logical Volume
# - Used to cache data for another logical volume, providing improved 
# performance.
# - Typically used with SSDs to cache data from slower spinning disks.
<code><span style="Color:DodgerBlue">lvcreate --type writeback --size 100M --name mycachelv myvg
</span></code><code><span style="Color:DodgerBlue">lvconvert --type writecache --cachevol myvg/mycachelv --name mycachedlv myvg/myoriginalvolume
</span></code>#
#- 1.3.6. Striped Logical Volume
# - Stripes data evenly across multiple physical volumes to enhance I/O
# performance. 
# - Allows parallel read and write operations.
<code><span style="Color:DodgerBlue">lvcreate --type striped -i 2 -I 4M -L 200G -n striped_lv myvg
</span></code></pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div4')"> 2. Physical Volume Commands
</a> </H4><div id="Div4" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 2.1. pvs
</B></span># - Provides physical volume information in a configurable form, displaying
# one line per physical volume
<code><span style="Color:DodgerBlue">sudo pvs
</span></code><code><span style="Color:DodgerBlue">sudo pvs /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.2. pvscan
</B></span># - Scans all supported LVM block devices in the system for physical volumes.
<code><span style="Color:DodgerBlue">sudo pvscan
</span></code>#
# - Locates and identifies the physical volumes on the system and updates the
# metadata cache used by LVM.
#
<B><span style="Font-Family:Verdana">#-- 2.3. pvdisplay
</B></span># - Provides a verbose multi-line output for each physical volume.
<code><span style="Color:DodgerBlue">sudo pvdisplay
</span></code><code><span style="Color:DodgerBlue">sudo pvdisplay /dev/sdb
</span></code>#
# - Display a mapping of the physical extents to the corresponding logical
# volumes.
<code><span style="Color:DodgerBlue">sudo pvdisplay -m /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.4. pvcreate 
</B></span># - Initializes a physical volume for use by LVM.
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdb
</span></code><code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdb1
</span></code>#  
# - Make sure the device or partition is not used. It will be erased.
# - After initializing, you can create or extend volume groups using the
# vgcreate or vgextend commands, respectively.
#
<B><span style="Font-Family:Verdana">#-- 2.5. pvremove
</B></span># - Removes LVM metadata from a physical volume.
<code><span style="Color:DodgerBlue">sudo pvremove /dev/sdb
</span></code><code><span style="Color:DodgerBlue">sudo pvremove /dev/sdb1
</span></code>#
# - Make sure you are not removing a used PV. 
# - Remove any logical volumes and volume groups associated with the physical
# volume before running `pvremove`.
#
# - After pvremove, you can repurpose the device or partition for other uses,
# like creating a new partition, filesystem, etc.
#
<B><span style="Font-Family:Verdana">#-- 2.6. pvmove 
</B></span># - Move allocated physical extents from one physical volume to another within
# the same volume group. 
# Move all the data in /dev/sda1 to /dev/sdb1. They must be in the same VG
<code><span style="Color:DodgerBlue">sudo pvmove /dev/sda1 /dev/sdb1
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.7. pvresize
</B></span># - Resize a physical volume
<code><span style="Color:DodgerBlue">sudo pvresize /dev/sdb1
</span></code>#
# - Must be used when the underlying block device is resized.
#
<B><span style="Font-Family:Verdana">#-- 2.8. pvchange
</B></span># - Changes the properties (allocatable, uuid, tags etc) of a physical volume.
# - Make the physical volume /dev/sdb1 allocatable
<code><span style="Color:DodgerBlue">sudo pvchange -x y /dev/sdb1
</span></code>#
# - Deactivate (disable) the physical volume in verbose mode.
<code><span style="Color:DodgerBlue">sudo pvchange -x y /dev/sdb1
</span></code>#
<B><span style="Font-Family:Verdana">#-- 2.9. pvck
</B></span># - Checks and repairs LVM metadata on PVs
# Check a PV
<code><span style="Color:DodgerBlue">sudo pvck /dev/sdb1
</span></code></pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div5')"> 3. Volume Group Commands:
</a> </H4><div id="Div5" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 3.1. vgs
</B></span># - Provides volume group information in a configurable form, displaying
# one line per volume group
<code><span style="Color:DodgerBlue">sudo vgs
</span></code><code><span style="Color:DodgerBlue">sudo vgs myvg
</span></code>#
<B><span style="Font-Family:Verdana">#-- 3.2. vgscan
</B></span># - Scans all supported LVM block devices in the system for volume groups.
<code><span style="Color:DodgerBlue">sudo vgscan
</span></code>#
# - Updates the metadata cache used by LVM. This cache maintains information
# about the volume groups on the system.
#
<B><span style="Font-Family:Verdana">#-- 3.3. vgdisplay
</B></span># - Displays volume group properties such as size, extents, number of physical
# volumes, and other options in a fixed form.
<code><span style="Color:DodgerBlue">sudo vgdisplay
</span></code><code><span style="Color:DodgerBlue">sudo vgdisplay myvg
</span></code>#
<B><span style="Font-Family:Verdana">#-- 3.4. vgcreate
</B></span># Creates a new volume group.
# Create a new volume group named myvg using the physical volume /dev/sdb1
<code><span style="Color:DodgerBlue">sudo vgcreate myvg /dev/sdb1
</span></code>#
# - Before vgcreate, physical volumes must be initialized with pvcreate.
# - Volume group names are case-sensitive.
# - When creating a volume group, LVM considers the total size of the physical
# volumes.
# - After creating a volume group with vgcreate, you can proceed to create
# logical volumes.
#
<B><span style="Font-Family:Verdana">#-- 3.5. vgextend
</B></span># Adds physical volumes to an existing volume group.
# Add physical volume /dev/sdb2 to the volume group myvg
<code><span style="Color:DodgerBlue">sudo vgextend myvg /dev/sdb2
</span></code>#
# - Before using vgextend, ensure that the physical volumes you specify are
# initialized with pvcreate.
# - After extending a volume group with vgextend, you can use the additional
# storage space to either extend existing logical volumes or create new ones
# within the extended volume group.
#
<B><span style="Font-Family:Verdana">#-- 3.6. vgreduce
</B></span># Remove one or more physical volumes from a volume group. 
# Remove /dev/sdb2 from volume group myvg
<code><span style="Color:DodgerBlue">sudo vgreduce myvg /dev/sdb1
</span></code>#
# - When removing a physical volume, the data on that physical volume is moved
# to other available physical volumes in the volume group.
# - Removing a physical volume from a volume group is a significant operation
# and can impact data availability. Ensure that you have proper backups before
# performing such operations.
#
<B><span style="Font-Family:Verdana">#-- 3.7. vgremove
</B></span># Removes a volume group.
<code><span style="Color:DodgerBlue">sudo vgremove myvg
</span></code>#
# - Before using `vgremove`, ensure that there are no logical volumes or other
# dependencies associated with the volume group.
#- Remove any logical volumes within the volume group using lvremove before
# using vgremove.
# - Ensure that any filesystems mounted from logical volumes within the volume
# group are unmounted before attempting to remove the volume group.
# - After removing a volume group with vgremove, the physical volumes that
# were part of the volume group become unallocated, and you can repurpose them
# for other uses.
#  
<B><span style="Font-Family:Verdana">#-- 3.8. vgchange
</B></span># Change the attributes of a volume group.
# Activate (enable) the volume group myvg.
<code><span style="Color:DodgerBlue">sudo vgchange -a y myvg
</span></code>#
# "-a y" or "-a n": Activates (-a y) or deactivates (-a n) the volume group.
#
<B><span style="Font-Family:Verdana">#-- 3.9. vgrename
</B></span># Renames a volume group.
<code><span style="Color:DodgerBlue">sudo vgrename oldvg newvg
</span></code>#
<B><span style="Font-Family:Verdana">#-- 3.10. vgck
</B></span># - Checks the consistency of volume groups
<code><span style="Color:DodgerBlue">sudo vgck
</span></code># - Rewrite VG metadata to correct problems.
<code><span style="Color:DodgerBlue">sudo vgck --updatemetadata myvg -v
</span></code>#
<B><span style="Font-Family:Verdana">#-- 3.11. Other Commands:
</B></span># vgcfgbackup     : Backup volume group configurations.
# vgcfgrestore    : Restore volume group configuration
# vgconvert       : Change volume group metadata format.
# vgexport        : Unregister volume group(s) from the system.
# vgimport        : Register exported volume group with system.
# vgimportclone   : Import a VG from cloned PVs.
# vgmerge         : Merge volume groups.
# vgmknodes       : Create the special files for volume group devices in /dev.
# vgsplit         : Move PVs into a new or existing volume group
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div6')"> 4. Logical Volume Commands:
</a> </H4><div id="Div6" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 4.1. lvs
</B></span># - Provides logical volume information in a configurable form, displaying one
# line per logical volume
<code><span style="Color:DodgerBlue">sudo lvs
</span></code><code><span style="Color:DodgerBlue">sudo lvs /dev/vg_name/lv_name
</span></code><code><span style="Color:DodgerBlue">sudo lvs /dev/myvg/mylv
</span></code># All LVs in a VG
<code><span style="Color:DodgerBlue">sudo lvs /dev/vg_name
</span></code><code><span style="Color:DodgerBlue">sudo lvs /dev/myvg
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.2. lvscan
</B></span># Scans for all logical volumes in the system and lists them.
<code><span style="Color:DodgerBlue">sudo lvscan
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.3. lvdisplay
</B></span># - Displays logical volume properties, such as size, layout, and mapping in a
# fixed format
<code><span style="Color:DodgerBlue">sudo lvdisplay
</span></code><code><span style="Color:DodgerBlue">sudo lvdisplay myvg/mylv
</span></code>#
# Specify units in megabytes
<code><span style="Color:DodgerBlue">sudo lvdisplay --unit m myvg/mylv
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.4. lvcreate
</B></span># Creates a new logical volume within a volume group.
#
# Create a new LV named mylv in myvg VG with size 11 GB
<code><span style="Color:DodgerBlue">sudo lvcreate -L 11G -n mylv myvg
</span></code>#
# Format created logical volume:
<code><span style="Color:DodgerBlue">sudo mkfs -t ext4 /dev/myvg/mylv
</span></code>#
# Mount it
<code><span style="Color:DodgerBlue">sudo mkdir /mnt/point
</span></code><code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mylv /mnt/point
</span></code># Unmount it
<code><span style="Color:DodgerBlue">sudo umount /mnt/point
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.5. lvextend
</B></span># Extends the size of a logical volume.
# Extend mylv logical volume by 2 GB
<code><span style="Color:DodgerBlue">sudo lvextend -L +2G myvg/mylv
</span></code># 
# Resize the file system
<code><span style="Color:DodgerBlue">sudo resize2fs /dev/myvg/mylv
</span></code># xfs_growfs is used for XFS.
#
<B><span style="Font-Family:Verdana">#-- 4.6. lvreduce
</B></span># Reduces the size of a logical volume.
# Reduce the logical volume mylv in the volume group myvg by 2 GB.
<code><span style="Color:DodgerBlue">sudo lvreduce -L -1G myvg/mylv
</span></code>#
# Resize the file system (you may need to unmount the LV)
<code><span style="Color:DodgerBlue">sudo resize2fs /dev/myvg/mylv
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.7. lvremove
</B></span># Removes a logical volume.
# Remove the logical volume mylv in the volume group myvg.
<code><span style="Color:DodgerBlue">sudo lvremove myvg/mylv
</span></code>#
# - The command permanently deletes the data.
# - Ensure that any filesystems mounted from the logical volume are unmounted
# before attempting to remove it.
# 
#
<B><span style="Font-Family:Verdana">#-- 4.8. lvchange
</B></span># Changes the attributes and status of a logical volume. Activate or 
# deactivate a logical volume, modify its permission flags, or change its
# allocation policy.  
#
# - Deactivate (or sets to "no") the activation of the logical volume mylv in
# the volume group myvg.
<code><span style="Color:DodgerBlue">sudo lvchange -a n myvg/mylv
</span></code># - Activate it
<code><span style="Color:DodgerBlue">sudo lvchange -a y myvg/mylv
</span></code>#
# Sets the read-only permission in a logical volume
<code><span style="Color:DodgerBlue">sudo lvchange -p r myvg/mylv
</span></code>#
# Sets back the read/write permission in a logical volume
<code><span style="Color:DodgerBlue">sudo lvchange -p rw myvg/mylv
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.9. lvrename
</B></span># Renames a logical volume name
<code><span style="Color:DodgerBlue">sudo lvrename myvg mylv mynewlv2
</span></code>#
<B><span style="Font-Family:Verdana">#-- 4.10. Other Commands
</B></span># lvconvert : Change logical volume layout.
# lvresize  : Resize a logical volume.
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div7')"> 5. Case Study 1 - Installing LVM and Manipulating Disks, PVs, VGs, LVs
</a> </H4><div id="Div7" style="margin-left:1%;"><pre ><B><span style="Font-Family:Verdana">#-- 5.0. Specs
</B></span># We have a system installed without LVM. 
# - Add a 20 GB disk and use it as a LV
# - Add a 30 GB disk and extend the LV
# - Add a 50 GB disk, extend the VG and move data to this disk
# - Remove 20 GB and 30 GB disks.
#
# The steps:
# 1. Install LVM
# 2. Add 20 GB disk
# 3. Create a PV from the disk
# 4. Create a VG from the PV
# 5. Create a LV within the VG
# 6. Create a Filesystem in the LV
# 7. Mount the FS 
# 8. Add 30 GB disk
# 9. Create a PV from the 2nd disk
# 10. Extend the VG with this PV
# 11. Extend the LV
# 12. Extend the Filesystem
# 13. Add 50 GB disk
# 14. Create a PV from the 3rd disk
# 15. Extend the VG with this PV
# 16. Move data from 20 GB and 30 GB disks to 50 GB disk
# 17. Remove 20 GB and 30 GB disks as PV
# 18. Remove 20 GB and 30 GB disks from the system and check everything
#
<B><span style="Font-Family:Verdana">#-- 5.1. Install LVM Packages
</B></span><code><span style="Color:DodgerBlue">sudo apt update
</span></code><code><span style="Color:DodgerBlue">sudo apt -y install lvm2
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.2. Add 20 GB Disk
</B></span># - Output of "lsblk -i" command before adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
</span></code>#
# - For physical servers, you need to add a disk to the hardware. For virtual
# servers you have to define it and attach it to the VM.
#
# - I'm adding a 20 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
sdb      8:16   0   20G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdb.
# - At the following steps, you need to change /dev/sdb to your disk device 
# name.
#
<B><span style="Font-Family:Verdana">#-- 5.3. Create a PV from the Disk
</B></span># Mark /dev/sdb as a PV
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.4. Create a VG from the PV
</B></span># Create a VG named "myvg" using /dev/sdb
<code><span style="Color:DodgerBlue">sudo vgcreate myvg /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.5. Create a LV Within the VG
</B></span># Create the LV using the maximum available size with name mylv
<code><span style="Color:DodgerBlue">sudo lvcreate -l +100%FREE -n mylv myvg
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.6. Create a Filesystem in the LV
</B></span># Format as Ext4
<code><span style="Color:DodgerBlue">sudo mkfs -t ext4 /dev/myvg/mylv
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.7. Mount the FS 
</B></span># Create a mount point
<code><span style="Color:DodgerBlue">sudo mkdir /mnt/mylv
</span></code># Mount mylv to mount point /mnt/mylv
<code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mylv /mnt/mylv
</span></code># 
# - If you want the mount to be persistent, add to the end of /etc/fstab
<code><span style="Color:DodgerBlue">sudo nano /etc/fstab
</span></code><code><span style="Color:MediumSeaGreen">/dev/myvg/mylv    /mnt/mylv    ext4    defaults    0 0
</span></code>#
# Check with lsblk
<code><span style="Color:DodgerBlue">lsblk -i
</span></code># Output of the command
<code><span style="Color:MediumSeaGreen">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part &lsqb;SWAP&rsqb;
sdb           8:16   0   20G  0 disk 
`-myvg-mylv 254:0    0   20G  0 lvm  /mnt/mylv
</span></code>#
# Check with df -h
<code><span style="Color:DodgerBlue">df -h
</span></code># Output of the command
<code><span style="Color:MediumSeaGreen">Filesystem             Size  Used Avail Use% Mounted on
udev                   457M     0  457M   0% /dev
tmpfs                   97M  544K   96M   1% /run
/dev/sda1               22G  1.8G   19G   9% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/mapper/myvg-mylv   20G   44K   19G   1% /mnt/mylv
tmpfs                   97M     0   97M   0% /run/user/1000
</span></code>#
# - Create some big files in the filesystem
# Create a directory for files
<code><span style="Color:DodgerBlue">sudo mkdir /mnt/mylv/tmp
</span></code># Make it writable for everyone
<code><span style="Color:DodgerBlue">sudo chmod 777 /mnt/mylv/tmp
</span></code># Create files of 500 MB each
<code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c500M &gt; /mnt/mylv/tmp/file1
</span></code><code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c500M &gt; /mnt/mylv/tmp/file2
</span></code><code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c500M &gt; /mnt/mylv/tmp/file3
</span></code># 
# Check contents
<code><span style="Color:DodgerBlue">ls -al /mnt/mylv/tmp
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.8. Add 30 GB disk
</B></span># - I'm adding a 30 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part &lsqb;SWAP&rsqb;
sdb           8:16   0   20G  0 disk 
`-myvg-mylv 254:0    0   20G  0 lvm  /mnt/mylv
sdc           8:32   0   30G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdc.
# - At the following steps, you need to change /dev/sdc to your disk device 
# name.
#
<B><span style="Font-Family:Verdana">#-- 5.9. Create a PV from the Second Disk
</B></span># Mark /dev/sdc as a PV
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdc
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.10. Extend the VG with this PV
</B></span># Add /dev/sdc to VG myvg
<code><span style="Color:DodgerBlue">sudo vgextend myvg /dev/sdc
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.11. Extend the LV
</B></span># Extend mylv LV to maximum
<code><span style="Color:DodgerBlue">sudo lvextend -l +100%FREE  myvg/mylv
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.12. Extend the Filesystem
</B></span><code><span style="Color:DodgerBlue">sudo resize2fs /dev/myvg/mylv
</span></code>#
# Check "df -h" command to check the new size
<code><span style="Color:DodgerBlue">df -h
</span></code># Output of the command
<code><span style="Color:MediumSeaGreen">Filesystem             Size  Used Avail Use% Mounted on
udev                   457M     0  457M   0% /dev
tmpfs                   97M  548K   96M   1% /run
/dev/sda1               22G  3.2G   18G  16% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/mapper/myvg-mylv   50G  1.5G   46G   4% /mnt/mylv
</span></code>#
# Add another big file
<code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c500M &gt; /mnt/mylv/tmp/file4
</span></code>#
# Check contents
<code><span style="Color:DodgerBlue">ls -al /mnt/mylv/tmp
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.13. Add 50 GB disk
</B></span># - I'm adding a 50 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda           8:0    0 22.9G  0 disk 
|-sda1        8:1    0   22G  0 part /
|-sda2        8:2    0    1K  0 part 
`-sda5        8:5    0  976M  0 part &lsqb;SWAP&rsqb;
sdb           8:16   0   20G  0 disk 
`-myvg-mylv 254:0    0   30G  0 lvm  /mnt/mylv
sdc           8:32   0   30G  0 disk 
`-myvg-mylv 254:0    0   30G  0 lvm  /mnt/mylv
sdd           8:48   0   50G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdd.
# - At the following steps, you need to change /dev/sdd to your disk device 
# name.
#
<B><span style="Font-Family:Verdana">#-- 5.14. Create a PV from the 3rd disk
</B></span># Mark /dev/sdd as a PV
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdd
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.15. Extend the VG with this PV
</B></span># Add /dev/sdd to VG myvg
<code><span style="Color:DodgerBlue">sudo vgextend myvg /dev/sdd
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.16. Move data from 20 GB and 30 GB disks to 50 GB disk
</B></span># - Move from 20 GB disk to 50 GB disk
<code><span style="Color:DodgerBlue">sudo pvmove /dev/sdb /dev/sdd
</span></code># - Move from 30 GB disk to 50 GB disk
<code><span style="Color:DodgerBlue">sudo pvmove /dev/sdc /dev/sdd
</span></code># These may take some time
#
<B><span style="Font-Family:Verdana">#-- 5.17. Remove 20 GB and 30 GB disks as PV
</B></span># First remove them from the VG
<code><span style="Color:DodgerBlue">sudo vgreduce myvg /dev/sdb
</span></code><code><span style="Color:DodgerBlue">sudo vgreduce myvg /dev/sdc
</span></code># Now remove PVs (unmark them as PV)
<code><span style="Color:DodgerBlue">sudo pvremove /dev/sdb
</span></code><code><span style="Color:DodgerBlue">sudo pvremove /dev/sdc
</span></code>#
<B><span style="Font-Family:Verdana">#-- 5.18. Remove 20 GB and 30 GB disks from the system and check everything
</B></span># At this step we physically remove (or unattach 20 GB and 30 GB disks)
#
# Output of "lsblk -i command" after removing the disks
<code><span style="Color:DodgerBlue">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
</span></code><code><span style="Color:DodgerBlue">sda           8:0    0 22.9G  0 disk 
</span></code><code><span style="Color:DodgerBlue">|-sda1        8:1    0   22G  0 part /
</span></code><code><span style="Color:DodgerBlue">|-sda2        8:2    0    1K  0 part 
</span></code><code><span style="Color:DodgerBlue">`-sda5        8:5    0  976M  0 part &lsqb;SWAP&rsqb;
</span></code><code><span style="Color:DodgerBlue">sdb           8:16   0   50G  0 disk 
</span></code><code><span style="Color:DodgerBlue">`-myvg-mylv 254:0    0   30G  0 lvm  /mnt/mylv
</span></code>#
# - As you can see, /dev/sdd became /dev/sdb but there is no problem. Our LVM
# is still working.
#
# Check contents
<code><span style="Color:DodgerBlue">ls -al /mnt/mylv/tmp
</span></code></pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div8')"> 6. Case Study 2 - LVM and Snapshot
</a> </H4><div id="Div8" style="margin-left:1%;"><pre ># - When we take a snapshot, we create a place to save the original states of
# the files that are changed after the snapshot.
# - That way, those original states can be used to revert to the snapshot.
# - Because only the originals of the changed data is backed up, snapshots 
# do not require a lot of place.
# - If a snapshot is full, the snapshot becomes invalid because it can no longer track changes on the origin volume. 
# - Snapshots are resizable.
#
<B><span style="Font-Family:Verdana">#-- 6.0. Specs
</B></span># We have a system installed with LVM. 
# - Add a 20 GB disk and use it to extend the system disk
# - Add a 30 GB disk and create a new VG with it
# - Create a snapshot using the 30 GB disk
# - Change the system dramatically and revert to the snapshot
#
# The steps:
# 1. Add 20 GB disk
# 2. Create a PV from the disk
# 3. Extend the VG with this PV
# 4. Extend the LV
# 5. Extend the Filesystem
# 6. Add 30 GB disk
# 7. Create a PV from the disk
# 8. Create a new VG with this PV
# 9. Create a snapshot of the system disk
# 10. Make some changes on the system disk
# 11. Mount the Snapshot and Check Its Content
# 12. Extend the Snapshot
# 13. Revert to the snapshot
#
<B><span style="Font-Family:Verdana">#-- 6.1. Add 20 GB disk
</B></span># - Output of "lsblk -i" command before adding the disk:
<code><span style="Color:MediumSeaGreen">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   20G  0 disk 
|-sda1            8:1    0  487M  0 part /boot
|-sda2            8:2    0    1K  0 part 
`-sda5            8:5    0 19.5G  0 part 
  |-myvg-root   254:0    0 18.6G  0 lvm  /
  `-myvg-swap_1 254:1    0  980M  0 lvm  &lsqb;SWAP&rsqb;
</span></code>#
# - Not: When installing LVM at the install time, Debian lets you choose the
# VG name, as I choose it as myvg. Debian chooses the LV name as root.
# Ubuntu doesn't let us choosing VG and LV names, they are given as ubuntu-vg
# and ubuntu-lv.
#
# - So the outputs would be different for Ubuntu and Debian. The above output 
# is from Debian.
#
# - Output of "pvs" before adding the disk
<code><span style="Color:MediumSeaGreen">  PV         VG   Fmt  Attr PSize   PFree
  /dev/sda5  myvg lvm2 a--  &lt;19.52g    0 
</span></code>#
# - Output of "lvscan" before adding the disk
<code><span style="Color:MediumSeaGreen">  ACTIVE            '/dev/myvg/root' &lsqb;18.56 GiB&rsqb; inherit
  ACTIVE            '/dev/myvg/swap_1' &lsqb;980.00 MiB&rsqb; inherit
</span></code>#
# - Output of "df -h" before adding the disk
<code><span style="Color:MediumSeaGreen">Filesystem             Size  Used Avail Use% Mounted on
udev                   458M     0  458M   0% /dev
tmpfs                   97M  544K   96M   1% /run
/dev/mapper/myvg-root   19G  1.6G   16G  10% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/sda1              455M   98M  333M  23% /boot
tmpfs                   97M     0   97M   0% /run/user/1000
</span></code>#
# - For physical servers, you need to add a disk to the hardware. For virtual
# servers you have to define it and attach it to the VM.
#
# - I'm adding a 20 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda               8:0    0   20G  0 disk 
|-sda1            8:1    0  487M  0 part /boot
|-sda2            8:2    0    1K  0 part 
`-sda5            8:5    0 19.5G  0 part 
  |-myvg-root   254:0    0 18.6G  0 lvm  /
  `-myvg-swap_1 254:1    0  980M  0 lvm  &lsqb;SWAP&rsqb;
sdb               8:16   0   20G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdb.
# - At the following steps, you need to change /dev/sdb to your disk device 
# name.
#
<B><span style="Font-Family:Verdana">#-- 6.2. Create a PV from the disk
</B></span># Mark /dev/sdb as a PV
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.3. Extend the VG with this PV
</B></span># Add /dev/sdb to VG myvg
<code><span style="Color:DodgerBlue">sudo vgextend myvg /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.4. Extend the LV
</B></span># Extend root LV (LV defined at the system install) to maximum
<code><span style="Color:DodgerBlue">sudo lvextend -l +100%FREE  myvg/root
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.5. Extend the Filesystem
</B></span><code><span style="Color:DodgerBlue">sudo resize2fs /dev/myvg/root
</span></code>#
# - Output of "df -h" after expanding the disk
<code><span style="Color:MediumSeaGreen">Filesystem             Size  Used Avail Use% Mounted on
udev                   458M     0  458M   0% /dev
tmpfs                   97M  548K   96M   1% /run
/dev/mapper/myvg-root   38G  1.6G   35G   5% /
tmpfs                  481M     0  481M   0% /dev/shm
tmpfs                  5.0M     0  5.0M   0% /run/lock
/dev/sda1              455M   98M  333M  23% /boot
tmpfs                   97M     0   97M   0% /run/user/1000
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.6. Add 30 GB disk
</B></span># - I'm adding a 30 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">sda               8:0    0   20G  0 disk 
|-sda1            8:1    0  487M  0 part /boot
|-sda2            8:2    0    1K  0 part 
`-sda5            8:5    0 19.5G  0 part 
  |-myvg-root   254:0    0 38.6G  0 lvm  /
  `-myvg-swap_1 254:1    0  980M  0 lvm  &lsqb;SWAP&rsqb;
sdb               8:16   0   20G  0 disk 
`-myvg-root     254:0    0 38.6G  0 lvm  /
sdc               8:32   0   30G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdc.
# - At the following steps, you need to change /dev/sdc to your disk device 
# name.
#
<B><span style="Font-Family:Verdana">#-- 6.7. Create a PV from the disk
</B></span># Mark /dev/sdc as a PV
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdc
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.8. Extend the VG with this PV
</B></span><code><span style="Color:DodgerBlue">sudo vgextend myvg /dev/sdc
</span></code># Snapshots must be in the same VG as the original LV
#
<B><span style="Font-Family:Verdana">#-- 6.9. Create a snapshot of the system disk
</B></span># Create a snapshot named mysnapshot of LV root from VG myvg. Size is 2 GB.
<code><span style="Color:DodgerBlue">sudo lvcreate --type snapshot -n mysnapshot -L 2G --snapshot /dev/myvg/root
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.10. Make some changes on the system disk
</B></span># - Well, the idea is to change the data on the myvg/root LV. I'll try
# installing some software.
#
<code><span style="Color:DodgerBlue">sudo apt update
</span></code><code><span style="Color:DodgerBlue">sudo apt install apache2 mariadb-server
</span></code>#
# Let's check our Snapshot
<code><span style="Color:DodgerBlue">sudo lvs -o lv_name,lv_size,origin
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.11. Mount the Snapshot and Check Its Content
</B></span># Create a temporary mount point
<code><span style="Color:DodgerBlue">sudo mkdir /mnt/mysnapshot
</span></code># Mount the snapshot to the mount point
<code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mysnapshot /mnt/mysnapshot
</span></code>#
# In /mnt/mysnapshot, you'll see the changed folders and files
# Unmount it
<code><span style="Color:DodgerBlue">sudo umount /mnt/mysnapshot
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.12. Extend the Snapshot
</B></span># We may extend the snapshot to allow more changes on the origin LV
<code><span style="Color:DodgerBlue">sudo lvextend -L+1G /dev/myvg/mysnapshot
</span></code>#
<B><span style="Font-Family:Verdana">#-- 6.13. Revert to the Snapshot
</B></span># - When we are done, we can revert to the snapshot. 
# - Normally, reverting to a snapshot requires the original volume to be 
# unmounted. But since we cannot unmount the root volume, we are going to need
# to reboot the system.
<code><span style="Color:DodgerBlue">sudo lvconvert --merge myvg/mysnapshot
</span></code><code><span style="Color:DodgerBlue">sudo reboot
</span></code># - Our snapshot LV is gone after the merge.
</pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div9')"> 7. Case Study 3 - Export and Import of LVM
</a> </H4><div id="Div9" style="margin-left:1%;"><pre ># - It is possible to export and import Volume Groups with their Logical 
# Volumes.
# - LVs are unmounted, VG is deactivated and exported, physical disks are
# moved, VG is imported and activated, and finally LVs are mounted
#
<B><span style="Font-Family:Verdana">#-- 7.1. Specs
</B></span># - We have 2 systems installed without LVM, srva and srvb. We will install
# a LV on srva, fill it with data, and we will move the LV to srvb.
#
# A. Prepare the first system
# 1. Install LVM to srva
# 2. Add 20 GB disk to srva
# 3. Create a PV from the disk
# 4. Create a VG from the PV
# 5. Create 2 LVs within the VG
# 6. Create 2 Filesystems in the LV
# 7. Mount the filesystems
# 8. Put test data on the filesystems 
#
# B. Export
# 9. Unmount logical volumes
# 10. Deactivate all logical volumes in the VG
# 11. Export the VG and Unplug the disk
#
# C. Prepare the second system
# 12. Install LVM to srvb
# 13. Plug the disk to srvb
#
# D. Import
# 14. Import the volume group
# 15. Activate the volume group
# 16. Mount the logical volumes
#
<B><span style="Font-Family:Verdana">#--7. 1. Install LVM to srva
</B></span><code><span style="Color:DodgerBlue">sudo apt update
</span></code><code><span style="Color:DodgerBlue">sudo apt -y install lvm2
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 2. Add 20 GB disk to srva
</B></span># - Output of "lsblk -i" command before adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
</span></code>#
# - For physical servers, you need to add a disk to the hardware. For virtual
# servers you have to define it and attach it to the VM.
#
# - I'm adding a 20 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
sdb      8:16   0   20G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdb.
# - At the following steps, you need to change /dev/sdb to your disk device 
# name.
#
<B><span style="Font-Family:Verdana">#--7. 3. Create a PV from the disk
</B></span># Mark /dev/sdb as a PV
<code><span style="Color:DodgerBlue">sudo pvcreate /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 4. Create a VG from the PV
</B></span># Create a VG named "myvg" using /dev/sdb
<code><span style="Color:DodgerBlue">sudo vgcreate myvg /dev/sdb
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 5. Create 2 LVs within the VG
</B></span># First LV is 10 GB
<code><span style="Color:DodgerBlue">sudo lvcreate -L 10G -n mylv1 myvg
</span></code># Second LV is the rest (~10GB)
<code><span style="Color:DodgerBlue">sudo lvcreate -l +100%FREE -n mylv2 myvg
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 6. Create Filesystems in the LVs
</B></span><code><span style="Color:DodgerBlue">sudo mkfs -t ext4 /dev/myvg/mylv1
</span></code><code><span style="Color:DodgerBlue">sudo mkfs -t ext4 /dev/myvg/mylv2
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 7. Mount the filesystems
</B></span># Create mount points
<code><span style="Color:DodgerBlue">sudo mkdir /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">sudo mkdir /mnt/mylv2
</span></code># Mount 
<code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mylv1 /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mylv2 /mnt/mylv2
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 8. Put test data on the filesystems 
</B></span># Make them writable for everyone
<code><span style="Color:DodgerBlue">sudo chmod 777 /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">sudo chmod 777 /mnt/mylv2
</span></code># Create 2 files of 100 MB for each LV
<code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c100M &gt; /mnt/mylv1/d1f1
</span></code><code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c100M &gt; /mnt/mylv1/d1f2
</span></code><code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c100M &gt; /mnt/mylv2/d2f1
</span></code><code><span style="Color:DodgerBlue">&lt; /dev/urandom tr -dc "&lsqb;:space:&rsqb;&lsqb;:print:&rsqb;" | head -c100M &gt; /mnt/mylv2/d2f2
</span></code>#
# Check the contents of the LVs
<code><span style="Color:DodgerBlue">ll /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">ll /mnt/mylv2
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 9. Unmount logical volumes
</B></span><code><span style="Color:DodgerBlue">sudo umount /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">sudo umount /mnt/mylv2
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 10. Deactivate all logical volumes in the VG
</B></span><code><span style="Color:DodgerBlue">sudo vgchange -an myvg
</span></code># Check with pvscan
<code><span style="Color:DodgerBlue">sudo pvscan
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 11. Export the VG and Unplug the disk
</B></span># Export the VG
<code><span style="Color:DodgerBlue">sudo vgexport myvg
</span></code>#
# Now it is time to unplug the 20 GB disk.
# - Output of "lsblk -i" command after removing the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 12. Install LVM to srvb
</B></span><code><span style="Color:DodgerBlue">sudo apt update
</span></code><code><span style="Color:DodgerBlue">sudo apt -y install lvm2
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 13. Plug the disk to srvb
</B></span># - Output of "lsblk -i" command before adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
</span></code>#
# - For physical servers, you need to add a disk to the hardware. For virtual
# servers you have to define it and attach it to the VM.
#
# - I'm adding a 20 GB disk to my VM.
#
# - Output of "lsblk -i" command after adding the disk:
<code><span style="Color:MediumSeaGreen">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 22.9G  0 disk 
|-sda1   8:1    0   22G  0 part /
|-sda2   8:2    0    1K  0 part 
`-sda5   8:5    0  976M  0 part &lsqb;SWAP&rsqb;
sdb      8:16   0   20G  0 disk 
</span></code>#
# - That means, my new disk is /dev/sdb.
#
<B><span style="Font-Family:Verdana">#--7. 14. Import the volume group
</B></span><code><span style="Color:DodgerBlue">sudo vgimport myvg
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 15. Activate the volume group
</B></span><code><span style="Color:DodgerBlue">sudo vgchange -ay myvg
</span></code>#
<B><span style="Font-Family:Verdana">#--7. 16. Mount the logical volumes
</B></span><code><span style="Color:DodgerBlue">sudo mkdir /mnt/mylv1 /mnt/mylv2
</span></code><code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mylv1 /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">sudo mount /dev/myvg/mylv2 /mnt/mylv2
</span></code>#
# Check the contents of the LVs
<code><span style="Color:DodgerBlue">ll /mnt/mylv1
</span></code><code><span style="Color:DodgerBlue">ll /mnt/mylv2
</span></code></pre> </div> </p>
<p> <H4><a href="javascript:myFunction('Div10')"> 8. Uncovered Subjects
</a> </H4><div id="Div10" style="margin-left:1%;"><pre ># The following subject are not covered in this tutorial:
#
# - Striped logical volumes
# - RAID logical volumes
# - Thin-provisioned logical volumes
# - Cache volumes
# - Using shared storage
# - Logical volume activation
# - Controlling Allocation
# - LVM object tags
#
# No promises but they might be covered in another tutorial
</pre> </div> </p>
</pre> </div> </p>
<br /><br /><br /><script>
function myFunction(divid) {
  var x = document.getElementById(divid);
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
var i;
var str;

for (i=1; i<11; i++) {
    str = "Div" + i.toString();
    myFunction(str);
}
</script></body> </html>